DataW <- DataW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "weighted")
DataNW <- DataW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "not weighted")
Data <- cbind(DataW, DataNW) %>%
reshape::melt()
p <- ggplot(Data, aes(Percent, fill=Taxonomy)) +
geom_density(alpha=0.5, adjust=BW) + GGPoptions +
geom_vline(data=med, aes(xintercept=grp.median), linetype="dashed") +
xlab("Trait filling (%)") + ylab("Density")
}
pAmphibians <- CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw)
View(DataW)
View(Habitat_mammal_nw)
CompareDist <- function(DataW, DataNW) {
browser()
DataW <- DataW[order(DataW$Best_guess_binomial), ]
DataNW <- DataNW[order(DataWN$Best_guess_binomial), ]
DataW <- DataW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "weighted")
DataNW <- DataNW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "not weighted")
Data <- cbind(DataW, DataNW) %>%
reshape::melt()
p <- ggplot(Data, aes(Percent, fill=Taxonomy)) +
geom_density(alpha=0.5, adjust=BW) + GGPoptions +
geom_vline(data=med, aes(xintercept=grp.median), linetype="dashed") +
xlab("Trait filling (%)") + ylab("Density")
}
pAmphibians <- CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw)
CompareDist <- function(DataW, DataNW) {
browser()
DataW <- DataW[order(DataW$Best_guess_binomial), ]
DataNW <- DataNW[order(DataNW$Best_guess_binomial), ]
DataW <- DataW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "weighted")
DataNW <- DataNW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "not weighted")
Data <- cbind(DataW, DataNW) %>%
reshape::melt()
p <- ggplot(Data, aes(Percent, fill=Taxonomy)) +
geom_density(alpha=0.5, adjust=BW) + GGPoptions +
geom_vline(data=med, aes(xintercept=grp.median), linetype="dashed") +
xlab("Trait filling (%)") + ylab("Density")
}
pAmphibians <- CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw)
View(Data)
ggplot(Data, aes(value, fill=variable)) +
geom_density(alpha=0.5, adjust=BW) + GGPoptions +
xlab("Trait filling (%)") + ylab("Density")
ggplot(Data, aes(value, fill=variable)) +
geom_density(alpha=0.5) + GGPoptions +
xlab("Trait filling (%)") + ylab("Density")
GGPoptions <- theme_classic() + theme(
panel.border = element_rect(colour = "black", fill=NA),
text = element_text(size=FontSize, family="serif"),
axis.text.x = element_text(color="black", margin=ggplot2::margin(10,0,3,0,"pt"), size=FontSize),
axis.text.y = element_text(color="black", margin=ggplot2::margin(0,10,0,5,"pt"), size=FontSize),
axis.ticks.length=unit(-0.1, "cm"),
legend.text=element_text(size=FontSize))
## Looking at the distributions with and without weights
GGPoptions <- theme_classic() + theme(
panel.border = element_rect(colour = "black", fill=NA),
text = element_text(size=13, family="serif"),
axis.text.x = element_text(color="black", margin=ggplot2::margin(10,0,3,0,"pt"), size=13),
axis.text.y = element_text(color="black", margin=ggplot2::margin(0,10,0,5,"pt"), size=13),
axis.ticks.length=unit(-0.1, "cm"),
legend.text=element_text(size=13))
ggplot(Data, aes(value, fill=variable)) +
geom_density(alpha=0.5) + GGPoptions +
xlab("Trait filling (%)") + ylab("Density")
CompareDist <- function(DataW, DataNW) {
GGPoptions <- theme_classic() + theme(
panel.border = element_rect(colour = "black", fill=NA),
text = element_text(size=13, family="serif"),
axis.text.x = element_text(color="black", margin=ggplot2::margin(10,0,3,0,"pt"), size=13),
axis.text.y = element_text(color="black", margin=ggplot2::margin(0,10,0,5,"pt"), size=13),
axis.ticks.length=unit(-0.1, "cm"),
legend.text=element_text(size=13))
DataW <- DataW[order(DataW$Best_guess_binomial), ]
DataNW <- DataNW[order(DataNW$Best_guess_binomial), ]
DataW <- DataW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "weighted")
DataNW <- DataNW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "not weighted")
Data <- cbind(DataW, DataNW) %>%
reshape::melt()
p <- ggplot(Data, aes(value, fill=variable)) +
geom_density(alpha=0.5, adjust=0.6) + GGPoptions +
xlab("Habitat breadth") + ylab("Density")
return(p)
}
CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw)
CompareDist <- function(DataW, DataNW) {
GGPoptions <- theme_classic() + theme(
panel.border = element_rect(colour = "black", fill=NA),
text = element_text(size=13, family="serif"),
axis.text.x = element_text(color="black", margin=ggplot2::margin(10,0,3,0,"pt"), size=13),
axis.text.y = element_text(color="black", margin=ggplot2::margin(0,10,0,5,"pt"), size=13),
axis.ticks.length=unit(-0.1, "cm"),
legend.text=element_text(size=13))
DataW <- DataW[order(DataW$Best_guess_binomial), ]
DataNW <- DataNW[order(DataNW$Best_guess_binomial), ]
DataW <- DataW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "weighted")
DataNW <- DataNW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "not weighted")
Data <- cbind(DataW, DataNW) %>%
reshape::melt()
p <- ggplot(Data, aes(value, fill=variable)) +
geom_density(alpha=0.5, adjust=1) + GGPoptions +
xlab("Habitat breadth") + ylab("Density")
return(p)
}
CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw)
CompareDist <- function(DataW, DataNW) {
GGPoptions <- theme_classic() + theme(
panel.border = element_rect(colour = "black", fill=NA),
text = element_text(size=13, family="serif"),
axis.text.x = element_text(color="black", margin=ggplot2::margin(10,0,3,0,"pt"), size=13),
axis.text.y = element_text(color="black", margin=ggplot2::margin(0,10,0,5,"pt"), size=13),
axis.ticks.length=unit(-0.1, "cm"),
legend.text=element_text(size=13))
DataW <- DataW[order(DataW$Best_guess_binomial), ]
DataNW <- DataNW[order(DataNW$Best_guess_binomial), ]
DataW <- DataW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "weighted")
DataNW <- DataNW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "not weighted")
Data <- cbind(DataW, DataNW) %>%
reshape::melt()
p <- ggplot(Data, aes(value, fill=variable)) +
geom_density(alpha=0.5, adjust=2) + GGPoptions +
xlab("Habitat breadth") + ylab("Density")
return(p)
}
pAmphibians <- CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw)
pAmphibians
CompareDist <- function(DataW, DataNW) {
GGPoptions <- theme_classic() + theme(
panel.border = element_rect(colour = "black", fill=NA),
text = element_text(size=13, family="serif"),
axis.text.x = element_text(color="black", margin=ggplot2::margin(10,0,3,0,"pt"), size=13),
axis.text.y = element_text(color="black", margin=ggplot2::margin(0,10,0,5,"pt"), size=13),
axis.ticks.length=unit(-0.1, "cm"),
legend.text=element_text(size=13))
DataW <- DataW[order(DataW$Best_guess_binomial), ]
DataNW <- DataNW[order(DataNW$Best_guess_binomial), ]
DataW <- DataW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "weighted")
DataNW <- DataNW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "not weighted")
Data <- cbind(DataW, DataNW) %>%
reshape::melt()
p <- ggplot(Data, aes(value, fill=variable)) +
geom_density(alpha=0.5, adjust=1.5) + GGPoptions +
xlab("Habitat breadth") + ylab("Density")
return(p)
}
pAmphibians <- CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw)
CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw)
CompareDist <- function(DataW, DataNW) {
GGPoptions <- theme_classic() + theme(
panel.border = element_rect(colour = "black", fill=NA),
text = element_text(size=13, family="serif"),
axis.text.x = element_text(color="black", margin=ggplot2::margin(10,0,3,0,"pt"), size=13),
axis.text.y = element_text(color="black", margin=ggplot2::margin(0,10,0,5,"pt"), size=13),
axis.ticks.length=unit(-0.1, "cm"),
legend.text=element_text(size=13))
DataW <- DataW[order(DataW$Best_guess_binomial), ]
DataNW <- DataNW[order(DataNW$Best_guess_binomial), ]
DataW <- DataW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "weighted")
DataNW <- DataNW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "not weighted")
Data <- cbind(DataW, DataNW) %>%
reshape::melt()
p <- ggplot(Data, aes(value, fill=variable)) +
geom_density(alpha=0.5, adjust=1.5) + GGPoptions +
xlab("Habitat breadth") + ylab("Density")
return(p)
}
CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw)
CompareDist(Habitat_bird_C, Habitat_bird_nw)
CompareDist(Habitat_reptile_C, Habitat_reptile_nw)
CompareDist(Habitat_mammal_C, Habitat_mammal_nw)
ggarrange(pMammals, pBirds, pReptiles, pAmphibians, ncol=2, nrow=2, common.legend = TRUE)
pAmphibians <- CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw)
pBirds <- CompareDist(Habitat_bird_C, Habitat_bird_nw)
pReptiles <- CompareDist(Habitat_reptile_C, Habitat_reptile_nw)
pMammals <- CompareDist(Habitat_mammal_C, Habitat_mammal_nw)
ggarrange(pMammals, pBirds, pReptiles, pAmphibians, ncol=2, nrow=2, common.legend = TRUE)
pAmphibians <- CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw) +
labs(tag = "D") + theme(plot.tag.position = c(0.3, 0.92))
pBirds <- CompareDist(Habitat_bird_C, Habitat_bird_nw)+
labs(tag = "B") + theme(plot.tag.position = c(0.3, 0.92))
pReptiles <- CompareDist(Habitat_reptile_C, Habitat_reptile_nw)+
labs(tag = "C") + theme(plot.tag.position = c(0.3, 0.92))
pMammals <- CompareDist(Habitat_mammal_C, Habitat_mammal_nw)+
labs(tag = "A") + theme(plot.tag.position = c(0.3, 0.92))
ggarrange(pMammals, pBirds, pReptiles, pAmphibians, ncol=2, nrow=2, common.legend = TRUE)
CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw) +
labs(tag = "D") + theme(plot.tag.position = c(0.5, 0.92))
CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw) +
labs(tag = "D") + theme(plot.tag.position = c(0.6, 0.92))
CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw) +
labs(tag = "D") + theme(plot.tag.position = c(0.8, 0.92))
CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw) +
labs(tag = "D") + theme(plot.tag.position = c(0.7, 0.92))
pAmphibians <- CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw) +
labs(tag = "D") + theme(plot.tag.position = c(0.7, 0.92))
pBirds <- CompareDist(Habitat_bird_C, Habitat_bird_nw)+
labs(tag = "B") + theme(plot.tag.position = c(0.7, 0.92))
pReptiles <- CompareDist(Habitat_reptile_C, Habitat_reptile_nw)+
labs(tag = "C") + theme(plot.tag.position = c(0.7, 0.92))
pMammals <- CompareDist(Habitat_mammal_C, Habitat_mammal_nw)+
labs(tag = "A") + theme(plot.tag.position = c(0.7, 0.92))
p <- ggarrange(pMammals, pBirds, pReptiles, pAmphibians, ncol=2, nrow=2, common.legend = TRUE)
ggsave(p, file="../../Results/Plots/Weighted_HB/distributions.pdf", width = 4, height = 4)
ggsave(p, file="../../Results/Plots/Weighted_HB/distributions.pdf", width = 6, height = 6)
pAmphibians <- CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw) +
labs(tag = "D") + theme(plot.tag.position = c(0.8, 0.92))
pBirds <- CompareDist(Habitat_bird_C, Habitat_bird_nw)+
labs(tag = "B") + theme(plot.tag.position = c(0.8, 0.92))
pReptiles <- CompareDist(Habitat_reptile_C, Habitat_reptile_nw)+
labs(tag = "C") + theme(plot.tag.position = c(0.8, 0.92))
pMammals <- CompareDist(Habitat_mammal_C, Habitat_mammal_nw)+
labs(tag = "A") + theme(plot.tag.position = c(0.8, 0.92))
p <- ggarrange(pMammals, pBirds, pReptiles, pAmphibians, ncol=2, nrow=2, common.legend = TRUE)
ggsave(p, file="../../Results/Plots/Weighted_HB/distributions.pdf", width = 6, height = 6)
pAmphibians <- CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw) +
labs(tag = "D") + theme(plot.tag.position = c(0.9, 0.92))
pBirds <- CompareDist(Habitat_bird_C, Habitat_bird_nw)+
labs(tag = "B") + theme(plot.tag.position = c(0.9, 0.92))
pReptiles <- CompareDist(Habitat_reptile_C, Habitat_reptile_nw)+
labs(tag = "C") + theme(plot.tag.position = c(0.9, 0.92))
pMammals <- CompareDist(Habitat_mammal_C, Habitat_mammal_nw)+
labs(tag = "A") + theme(plot.tag.position = c(0.9, 0.92))
p <- ggarrange(pMammals, pBirds, pReptiles, pAmphibians, ncol=2, nrow=2, common.legend = TRUE)
ggsave(p, file="../../Results/Plots/Weighted_HB/distributions.pdf", width = 6, height = 6)
## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
##                AIM: PREPARING HABITAT DATA FROM IUCN FILES FOR FURTHER TRAIT COMPILATION               ##
## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
X <- c("grid", "gridExtra", "ggpubr", "dplyr", "lattice", "stringr")
invisible(lapply(X, library, character.only=TRUE)); rm(X)
## Data corrected for taxonomy
IUCN_mammal_C <- read.csv("../../../1.Trait_compilation/Results/0.Data_resolved_taxonomy/Processed_datasets/Traits/IUCN_habitat_mammals.csv")
IUCN_amphibian_C <- read.csv("../../../1.Trait_compilation/Results/0.Data_resolved_taxonomy/Processed_datasets/Traits/IUCN_habitat_amphibians.csv")
IUCN_bird_C <- read.csv("../../../1.Trait_compilation/Results/0.Data_resolved_taxonomy/Processed_datasets/Traits/IUCN_habitat_birds.csv")
IUCN_reptile_C <- read.csv("../../../1.Trait_compilation/Results/0.Data_resolved_taxonomy/Processed_datasets/Traits/IUCN_habitat_reptiles.csv")
IUCN_amphibian_C$Best_guess_binomial %<>% as.character()
IUCN_mammal_C$Best_guess_binomial %<>% as.character()
IUCN_bird_C$Best_guess_binomial %<>% as.character()
IUCN_reptile_C$Best_guess_binomial %<>% as.character()
## Data uncorrected for taxonomy
IUCN_mammal_UN <- read.csv("../../Data/HabitatData_09_08_18_IUCN_unprocessed/API_HabitatLevel2_Mammals_20180726.csv", sep=",")
IUCN_amphibian_UN <- read.csv("../../Data/HabitatData_09_08_18_IUCN_unprocessed/API_HabitatLevel2_Amphibians_20180726.csv", sep=",")
IUCN_bird_UN <- read.csv("../../Data/HabitatData_09_08_18_IUCN_unprocessed/API_HabitatLevel2_Birds_20180726.csv", sep=",")
IUCN_reptile_UN <- read.csv("../../Data/HabitatData_09_08_18_IUCN_unprocessed/API_HabitatLevel2_Reptiles_20180726.csv", sep=",")
colnames(IUCN_mammal_UN)[7] <- "Best_guess_binomial"
colnames(IUCN_amphibian_UN)[7] <- "Best_guess_binomial"
colnames(IUCN_reptile_UN)[7] <- "Best_guess_binomial"
colnames(IUCN_bird_UN)[7] <- "Best_guess_binomial"
IUCN_amphibian_UN$Best_guess_binomial %<>% as.character()
IUCN_mammal_UN$Best_guess_binomial %<>% as.character()
IUCN_bird_UN$Best_guess_binomial %<>% as.character()
IUCN_reptile_UN$Best_guess_binomial %<>% as.character()
unique(IUCN_bird_C$Suitability)
View(IUCN_reptile_C)
source('~/PhD/PhD_analyses/1.Trait_compilation/Code/0.Prerequisites/0.6.IUCN_Habitat_classification.R', echo=TRUE)
CompareDist <- function(DataW, DataNW) {
GGPoptions <- theme_classic() + theme(
panel.border = element_rect(colour = "black", fill=NA),
text = element_text(size=13, family="serif"),
axis.text.x = element_text(color="black", margin=ggplot2::margin(10,0,3,0,"pt"), size=13),
axis.text.y = element_text(color="black", margin=ggplot2::margin(0,10,0,5,"pt"), size=13),
axis.ticks.length=unit(-0.1, "cm"),
legend.text=element_text(size=13))
DataW <- DataW[order(DataW$Best_guess_binomial), ]
DataNW <- DataNW[order(DataNW$Best_guess_binomial), ]
DataW <- DataW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "weighted")
DataNW <- DataNW %>%
select(Habitat_breadth_IUCN) %>%
setNames(., "not weighted")
Data <- cbind(DataW, DataNW) %>%
reshape::melt()
p <- ggplot(Data, aes(value, fill=variable)) +
geom_density(alpha=0.5, adjust=1.5) + GGPoptions +
xlab("Habitat breadth") + ylab("Density") +
scale_fill_hue(name="Sum of habitats")
return(p)
}
pAmphibians <- CompareDist(Habitat_amphibian_C, Habitat_amphibian_nw) +
labs(tag = "D") + theme(plot.tag.position = c(0.9, 0.92))
pBirds <- CompareDist(Habitat_bird_C, Habitat_bird_nw)+
labs(tag = "B") + theme(plot.tag.position = c(0.9, 0.92))
pReptiles <- CompareDist(Habitat_reptile_C, Habitat_reptile_nw)+
labs(tag = "C") + theme(plot.tag.position = c(0.9, 0.92))
pMammals <- CompareDist(Habitat_mammal_C, Habitat_mammal_nw)+
labs(tag = "A") + theme(plot.tag.position = c(0.9, 0.92))
p <- ggarrange(pMammals, pBirds, pReptiles, pAmphibians, ncol=2, nrow=2, common.legend = TRUE)
p
ggsave(p, file="../../Results/Plots/Weighted_HB/distributions.pdf", width = 6, height = 6)
table(Habitat_amphibian_C$Specialisation)
table(Habitat_mammal_C$Specialisation)
table(Habitat_bird_C$Specialisation)
table(Habitat_reptile_C$Specialisation)
unique(IUCN_amphibian_C$Suitability)
source('~/PhD/PhD_analyses/1.Trait_compilation/Code/0.Prerequisites/0.6.IUCN_Habitat_classification.R', echo=TRUE)
p
table(Habitat_amphibian_C$Specialisation)
table(Habitat_bird_C$Specialisation)
table(Habitat_mammal_C$Specialisation)
View(IUCN_amphibian_C)
Y <- IUCN_amphibian_C
X <- subset(Y, Suitability=="Suitable")
X <- subset(Y, Affinity=="Artificial")
View(X)
Y <- IUCN_amphibian_C
X <- subset(Y, Suitability=="Unknown")
X <- subset(Y, Affinity=="Artificial")
View(X)
X <- subset(Y, Suitability=="Unknown")
X <- subset(Y, Affinity=="Artificial")
View(X)
Y <- IUCN_amphibian_C
X <- subset(Y, Suitability=="Unknown")
View(X)
X <- subset(Y, Affinity=="Artificial")
View(X)
Y <- IUCN_amphibian_C
X <- subset(Y, Suitability=="Unknown")
X <- subset(X, Affinity=="Artificial")
View(X)
IUCN_Habitat_calc <- function(IUCN_Habitat, With_weights) {
IUCN_Habitat <- IUCN_Habitat %>%
mutate(Suitability=as.character(Suitability)) %>%
mutate(Suitability=ifelse(is.na(Suitability), "Unknown", Suitability))
IUCN_Habitat <- IUCN_Habitat %>%
mutate(Major.importance=as.character(Major.importance)) %>%
mutate(Major.importance=ifelse(is.na(Major.importance), "Unknown", Major.importance))
Species <- unique(IUCN_Habitat$Best_guess_binomial) %>%
as.data.frame() %>%
setNames(., "Best_guess_binomial") %>%
mutate(Habitat_breadth_IUCN=NA) %>%
mutate(Specialisation=NA)
for (i in 1:nrow(Species)) {
# Calculation of Habitat breadth
s <- subset(IUCN_Habitat, Best_guess_binomial==Species$Best_guess_binomial[i])
tbl <- table(s$Suitability, s$Major.importance) %>%
as.data.frame() %>%
setNames(., c("Suitability", "Major.importance", "N"))
if(With_weights){
tbl <- tbl %>%
mutate(Weight=ifelse((Suitability=="Suitable"| Suitability=="Unknown") & (Major.importance=="Yes"|Major.importance=="Unknown"), 1,
ifelse(Suitability=="Suitable" & Major.importance=="No", 0.8, 0.3))) %>%
mutate(Score=N*Weight)
}
if(!With_weights) {
tbl <- tbl %>%
mutate(Weight=1) %>%
mutate(Score=N*Weight)
}
Species$Habitat_breadth_IUCN[i] <- sum(tbl$Score)
if(Species$Best_guess_binomial[i]=="Alytes cisternasii") {  browser()}
if(Species$Best_guess_binomial[i]=="Alytes obstetricans") {  browser()}
# Assigning a specialisation on Natural habitats (if no artificial habitats are suitable)
if(any(s$Affinity=="Artificial" & (s$Suitability=="Suitable"|s$Suitability=="Unknown"), na.rm=TRUE)) {
Species$Specialisation[i] <- "Generalist"}
if(any(s$Affinity=="Other/unknown" & s$Suitability=="Suitable", na.rm=TRUE)) {
Species$Specialisation[i] <- NA}
else {Species$Specialisation[i] <- "Natural habitat specialist"}
}
return(Species)
}
## Amphibians
IUCN_amphibian_C %<>% .Set_H_type()
Habitat_amphibian_C <- IUCN_Habitat_calc(IUCN_amphibian_C, TRUE)
Species
View(s)
any(s$Affinity=="Artificial" & (s$Suitability=="Suitable"|s$Suitability=="Unknown")
, na.rm=TRUE)
View(Species)
any(s$Affinity=="Other/unknown" & s$Suitability=="Suitable", na.rm=TRUE)
source('~/PhD/PhD_analyses/1.Trait_compilation/Code/0.Prerequisites/0.6.IUCN_Habitat_classification.R', echo=TRUE)
View(s)
View(s)
View(Species)
table(Habitat_amphibian_C$Specialisation)
table(Habitat_bird_C$Specialisation)
table(Habitat_mammal_C$Specialisation)
table(Habitat_reptile_C$Specialisation)
p
## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
##                AIM: PREPARING HABITAT DATA FROM IUCN FILES FOR FURTHER TRAIT COMPILATION               ##
## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
X <- c("grid", "gridExtra", "ggpubr", "dplyr", "lattice", "stringr")
invisible(lapply(X, library, character.only=TRUE)); rm(X)
## Data corrected for taxonomy
IUCN_mammal_C <- read.csv("../../../1.Trait_compilation/Results/0.Data_resolved_taxonomy/Processed_datasets/Traits/IUCN_habitat_mammals.csv")
IUCN_amphibian_C <- read.csv("../../../1.Trait_compilation/Results/0.Data_resolved_taxonomy/Processed_datasets/Traits/IUCN_habitat_amphibians.csv")
IUCN_bird_C <- read.csv("../../../1.Trait_compilation/Results/0.Data_resolved_taxonomy/Processed_datasets/Traits/IUCN_habitat_birds.csv")
IUCN_reptile_C <- read.csv("../../../1.Trait_compilation/Results/0.Data_resolved_taxonomy/Processed_datasets/Traits/IUCN_habitat_reptiles.csv")
IUCN_amphibian_C$Best_guess_binomial %<>% as.character()
IUCN_mammal_C$Best_guess_binomial %<>% as.character()
IUCN_bird_C$Best_guess_binomial %<>% as.character()
IUCN_reptile_C$Best_guess_binomial %<>% as.character()
## Data uncorrected for taxonomy
IUCN_mammal_UN <- read.csv("../../Data/HabitatData_09_08_18_IUCN_unprocessed/API_HabitatLevel2_Mammals_20180726.csv", sep=",")
IUCN_amphibian_UN <- read.csv("../../Data/HabitatData_09_08_18_IUCN_unprocessed/API_HabitatLevel2_Amphibians_20180726.csv", sep=",")
IUCN_bird_UN <- read.csv("../../Data/HabitatData_09_08_18_IUCN_unprocessed/API_HabitatLevel2_Birds_20180726.csv", sep=",")
IUCN_reptile_UN <- read.csv("../../Data/HabitatData_09_08_18_IUCN_unprocessed/API_HabitatLevel2_Reptiles_20180726.csv", sep=",")
colnames(IUCN_mammal_UN)[7] <- "Best_guess_binomial"
colnames(IUCN_amphibian_UN)[7] <- "Best_guess_binomial"
colnames(IUCN_reptile_UN)[7] <- "Best_guess_binomial"
colnames(IUCN_bird_UN)[7] <- "Best_guess_binomial"
IUCN_amphibian_UN$Best_guess_binomial %<>% as.character()
IUCN_mammal_UN$Best_guess_binomial %<>% as.character()
IUCN_bird_UN$Best_guess_binomial %<>% as.character()
IUCN_reptile_UN$Best_guess_binomial %<>% as.character()
.Set_H_type <- function(IUCN_data) {
Func <- function(X) {
x <- strsplit(as.character(X), "[.]") %>% unlist
x <- x[1] %>% as.numeric(); return(x)}
IUCN_data$Code <- sapply(IUCN_data$code, Func)
IUCN_data <- IUCN_data %>% mutate(Affinity=ifelse(Code==1, "Forest",
ifelse(Code==2, "Savanna",
ifelse(Code==3, "Shrubland",
ifelse(Code==4, "Grassland",
ifelse(Code==5, "Wetland",
ifelse(Code==6, "Rocky areas",
ifelse(Code==7, "Caves and subterranean",
ifelse(Code==8, "Desert",
ifelse(Code==9|Code==10|Code==11, "Marine",
ifelse(Code==12|Code==13, "Marine intertidal or coastal/supratidal",
ifelse(Code==14|Code==15, "Artificial",
ifelse(Code==16, "Introduced vegetation",
ifelse(Code==17|Code==18, "Other/unknown", NA))))))))))))))
return(IUCN_data)
}
IUCN_Habitat_calc <- function(IUCN_Habitat, With_weights) {
IUCN_Habitat <- IUCN_Habitat %>%
mutate(Suitability=as.character(Suitability)) %>%
mutate(Suitability=ifelse(is.na(Suitability), "Unknown", Suitability))
IUCN_Habitat <- IUCN_Habitat %>%
mutate(Major.importance=as.character(Major.importance)) %>%
mutate(Major.importance=ifelse(is.na(Major.importance), "Unknown", Major.importance))
Species <- unique(IUCN_Habitat$Best_guess_binomial) %>%
as.data.frame() %>%
setNames(., "Best_guess_binomial") %>%
mutate(Habitat_breadth_IUCN=NA) %>%
mutate(Specialisation=NA)
for (i in 1:nrow(Species)) {
if(Species$Best_guess_binomial[i]=="Larus michahellis") {browser()}
# Calculation of Habitat breadth
s <- subset(IUCN_Habitat, Best_guess_binomial==Species$Best_guess_binomial[i])
tbl <- table(s$Suitability, s$Major.importance) %>%
as.data.frame() %>%
setNames(., c("Suitability", "Major.importance", "N"))
if(With_weights){
tbl <- tbl %>%
mutate(Weight=ifelse((Suitability=="Suitable"| Suitability=="Unknown") & (Major.importance=="Yes"|Major.importance=="Unknown"), 1,
ifelse(Suitability=="Suitable" & Major.importance=="No", 0.8, 0.3))) %>%
mutate(Score=N*Weight)
}
if(!With_weights) {
tbl <- tbl %>%
mutate(Weight=1) %>%
mutate(Score=N*Weight)
}
Species$Habitat_breadth_IUCN[i] <- sum(tbl$Score)
if(Species$Best_guess_binomial[i]=="Alytes cisternasii") {  browser()}
if(Species$Best_guess_binomial[i]=="Alytes obstetricans") {  browser()}
# Assigning a specialisation on Natural habitats (if no artificial habitats are suitable)
if(any(s$Affinity=="Artificial" & (s$Suitability=="Suitable"|s$Suitability=="Unknown"), na.rm=TRUE)) {
Species$Specialisation[i] <- "Generalist"}
else{
if(any(s$Affinity=="Other/unknown" & (s$Suitability=="Suitable"|s$Suitability=="Unknown"), na.rm=TRUE)) {
Species$Specialisation[i] <- NA}
else {Species$Specialisation[i] <- "Natural habitat specialist"}
}
}
return(Species)
}
## Birds
IUCN_bird_C %<>% .Set_H_type()
Habitat_bird_C <- IUCN_Habitat_calc(IUCN_bird_C, TRUE)
View(s)
View(s)
tbl
tbl
source('~/PhD/PhD_analyses/1.Trait_compilation/Code/0.Prerequisites/0.6.IUCN_Habitat_classification.R', echo=TRUE)
p
source('~/PhD/PhD_analyses/1.Trait_compilation/Code/1.Trait_compilation/0.SOURCE_ALL.R', echo=TRUE)
